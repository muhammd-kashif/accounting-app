@inherits LayoutComponentBase
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

<!-- Main Container -->
<div class="flex flex-col h-screen md:flex-row overflow-hidden bg-gray-100">

    <!-- Mobile Header (Visible only on mobile) -->
    <div class="bg-gray-800 text-white p-4 flex justify-between items-center md:hidden z-20 shadow-md">
        <h2 class="text-xl font-bold">ğŸ’¼ Accounting</h2>
        <button @onclick="ToggleMenu" class="focus:outline-none p-2 rounded hover:bg-gray-700">
            <!-- Hamburger Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </button>
    </div>

    <!-- Sidebar / Navigation -->
    <!-- Mobile: Fixed, slide-in, z-30 -->
    <!-- Desktop: Static/Relative, always visible (md:flex) -->
    <div class="@(IsMenuOpen ? "translate-x-0" : "-translate-x-full") md:translate-x-0 transform transition-transform duration-300 ease-in-out fixed inset-y-0 left-0 z-30 w-64 bg-gray-800 text-white flex flex-col md:relative md:flex-shrink-0 shadow-lg md:shadow-none">
        
        <!-- Sidebar Header -->
        <div class="p-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold hidden md:block">ğŸ’¼ Accounting</h2>
            <h2 class="text-xl font-bold md:hidden">Menu</h2>
            
            <!-- Close Button (Mobile Only) -->
            <button @onclick="ToggleMenu" class="md:hidden text-gray-400 hover:text-white focus:outline-none bg-gray-700 p-1 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div class="px-6 pb-4">
             <button @onclick="ToggleTheme" class="w-full text-sm bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded flex items-center justify-center gap-2 transition-colors">
                @themeLabel
            </button>
        </div>

        <!-- Scrollable Nav Links -->
        <nav class="flex-1 overflow-y-auto space-y-1 px-2 pb-6">
            <a href="/dashboard" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“Š Dashboard</a>
            
            <p class="text-xs text-gray-400 uppercase tracking-wider px-4 pt-4 pb-2">Sales</p>
            <a href="/customers" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ‘¥ Customers</a>
            <a href="/all-customers-ledger" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“’ Customer Ledger</a>
            <a href="/income" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ’° Income</a>
            
            <p class="text-xs text-gray-400 uppercase tracking-wider px-4 pt-4 pb-2">Expenses</p>
            <a href="/suppliers" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ¢ Vendors / Suppliers</a>
            <a href="/all-suppliers-ledger" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“’ Supplier Ledger</a>
            <a href="/products" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“¦ Stock</a>
            <a href="/purchases" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ›’ Add Expense</a>
            <a href="/bills" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“„ Bills</a>
            <a href="/pay-bills" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ’³ Pay Bills</a>
            <a href="/expense" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ’¸ Other Expenses</a>
            
            <p class="text-xs text-gray-400 uppercase tracking-wider px-4 pt-4 pb-2">Reports</p>
            <a href="/stock-report" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“Š Stock Report</a>
            <a href="/financial-reports" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“ˆ Financial Statements</a>
            <a href="/reports" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸ“Š General Reports</a>
            
            <hr class="my-4 border-gray-600" />
            <a href="/login" class="block px-4 py-2 rounded hover:bg-gray-700 transition" @onclick="CloseMenu">ğŸšª Logout</a>
        </nav>
    </div>

    <!-- Overlay (Visible only on mobile when menu is open) -->
    @if (IsMenuOpen)
    {
        <div class="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden glass-effect" @onclick="ToggleMenu"></div>
    }

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            @Body
        </main>
    </div>
</div>

@code {
    private string themeLabel = "ğŸŒ™ Dark";
    private bool IsMenuOpen = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var theme = await JSRuntime.InvokeAsync<string>("getTheme");
            themeLabel = theme == "dark" ? "â˜€ï¸ Light" : "ğŸŒ™ Dark";
            StateHasChanged();
        }
    }

    private void ToggleMenu()
    {
        IsMenuOpen = !IsMenuOpen;
    }

    private void CloseMenu()
    {
        IsMenuOpen = false;
    }

    private async Task ToggleTheme()
    {
        var theme = await JSRuntime.InvokeAsync<string>("toggleTheme");
        themeLabel = theme == "dark" ? "â˜€ï¸ Light" : "ğŸŒ™ Dark";
    }
}
